<div *ngIf="loading" class="loading-screen">
  Loading...
</div>

<div *ngIf="!loading" class="container">
  <ng-container *ngFor="let block of dataSource">
    <h3>Service Order: {{block.ServiceOrderID}} ({{block.ComponentTypeID}})</h3>
    <table mat-table [dataSource]="block.QualityStatements" class="mat-elevation-z8">

      <ng-container matColumnDef="group">
        <th mat-header-cell *matHeaderCellDef>Group</th>
        <td mat-cell *matCellDef="let statement"> {{statement.GroupName}} </td>
      </ng-container>

      <ng-container matColumnDef="statement">
        <th mat-header-cell *matHeaderCellDef>Statement</th>
        <td mat-cell *matCellDef="let statement"> {{statement.Statement}} </td>
      </ng-container>

      <ng-container *ngFor="let component of block.Components" [matColumnDef]="component.ComponentID.toString()">
        <th mat-header-cell *matHeaderCellDef> {{component.SerialNumber}} </th>
        <td mat-cell *matCellDef="let statement">
          <ng-container [ngSwitch]="statement.OutcomeTypeID">
            <mat-checkbox *ngSwitchCase="'flag'"
                          [checked]="statement.Values[component.ComponentID.toString()]"
                          (change)="updateValue(component.ComponentID.toString(), statement, $event, 'flag')">
            </mat-checkbox>
            <input *ngSwitchCase="'text'" matInput
                   [value]="statement.Values[component.ComponentID.toString()]"
                   (input)="updateValue(component.ComponentID.toString(), statement, $event, 'text')" />

            <input *ngSwitchCase="'number'" type="number" matInput
                   [value]="statement.Values[component.ComponentID.toString()]"
                   (input)="updateValue(component.ComponentID.toString(), statement, $event, 'number')" />
            <app-image-upload
              *ngSwitchCase="'picture'"
              [statementId]="statement.QualityStatementID.toString()"
              [thumbnailSrc]="imagePreviews[component.ComponentID.toString() + '_' + statement.QualityStatementID]"
              (pictureUploaded)="onPictureUploaded(component.ComponentID.toString(), statement.QualityStatementID, $event)">
            </app-image-upload>

            <span *ngSwitchDefault>Unsupported</span>
          </ng-container>

        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>
  </ng-container>

  <button mat-raised-button class="upload-button" color="primary" (click)="saveReport()">Save Report</button>

</div>
